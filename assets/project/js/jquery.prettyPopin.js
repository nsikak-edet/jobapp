var _followScroll=false;var _readyBound=false;(function($){$.fn.prettyPopin=function(settings){settings=jQuery.extend({modal:false,width:false,height:false,opacity:0.5,animationSpeed:'fast',followScroll:true,loader_path:'/images/prettyPopin/loader.gif',callback:function(){}},settings);function bindReady(){if(_readyBound)return;_readyBound=true;$(window).scroll(function(){_centerPopin();});$(window).resize(function(){_centerPopin();});};bindReady();return this.each(function(){var popinWidth;var popinHeight;var $c;$(this).click(function(){buildoverlay();buildpopin();$.get($(this).attr('href'),function(responseText){$('.prettyPopin .prettyContent .prettyContent-container').html(responseText);popinWidth=settings.width||$('.prettyPopin .prettyContent .prettyContent-container').width()+parseFloat($('.prettyPopin .prettyContent .prettyContent-container').css('padding-left'))+parseFloat($('.prettyPopin .prettyContent .prettyContent-container').css('padding-right'));$('.prettyPopin').width(popinWidth);popinHeight=settings.height||$('.prettyPopin .prettyContent .prettyContent-container').height()+parseFloat($('.prettyPopin .prettyContent .prettyContent-container').css('padding-top'))+parseFloat($('.prettyPopin .prettyContent .prettyContent-container').css('padding-bottom'));$('.prettyPopin').height(popinHeight);$('.prettyPopin').height(45).width(45);displayPopin();});return false;});var displayPopin=function(){var scrollPos=_getScroll();projectedTop=($(window).height()/2)+scrollPos['scrollTop']-(popinHeight/2);if(projectedTop<0){projectedTop=10;_followScroll=false;}else{_followScroll=settings.followScroll;};$('.prettyPopin').animate({'top':projectedTop,'left':($(window).width()/2)+scrollPos['scrollLeft']-(popinWidth/2),'width':popinWidth,'height':popinHeight},settings.animationSpeed,function(){displayContent();});};var buildpopin=function(){$('body').append('<div class="prettyPopin"><a href="#" id="b_close" rel="close">Close</a><div class="prettyContent"><img src="'+settings.loader_path+'" alt="Loading" class="loader" /><div class="prettyContent-container"></div></div></div>');$c=$('.prettyPopin .prettyContent .prettyContent-container');$('.prettyPopin a[rel=close]:eq(0)').click(function(){closeOverlay();return false;});var scrollPos=_getScroll();$('.prettyPopin').width(45).height(45).css({'top':($(window).height()/2)+scrollPos['scrollTop'],'left':($(window).width()/2)+scrollPos['scrollLeft']}).hide().fadeIn(settings.animationSpeed);};var buildoverlay=function(){$('body').append('<div id="overlay"></div>');$('#overlay').css('height',$(document).height());$('#overlay').css('opacity',0).fadeTo(settings.animationSpeed,settings.opacity);if(!settings.modal){$('#overlay').click(function(){closeOverlay();});};};var displayContent=function(){$c.parent().find('.loader').hide();$c.parent().parent().find('#b_close').show();$c.fadeIn(function(){$(this).find('input[type=text]:first').trigger('focus');$('.prettyPopin a[rel=internal]').click(function(){$link=$(this);$c.fadeOut(function(){$c.parent().find('.loader').show();$.get($link.attr('href'),function(responseText){$c.html(responseText);_refreshContent($c);});});return false;});$('.prettyPopin form').bind('submit',function(){$theForm=$(this);$c.fadeOut(function(){$c.parent().find('.loader').show();$.post($theForm.attr('action'),$theForm.serialize(),function(responseText){$c.html(responseText);_refreshContent($c);});});return false;});});$('.prettyPopin a[rel=close]:gt(0)').click(function(){closeOverlay();return false;});};var _refreshContent=function(){var scrollPos=_getScroll();if(!settings.width)popinWidth=$c.width()+parseFloat($c.css('padding-left'))+parseFloat($c.css('padding-right'));if(!settings.height)popinHeight=$c.height()+parseFloat($c.css('padding-top'))+parseFloat($c.css('padding-bottom'));projectedTop=($(window).height()/2)+scrollPos['scrollTop']-(popinHeight/2);if(projectedTop<0){projectedTop=10;_followScroll=false;}else{_followScroll=settings.followScroll;};$('.prettyPopin').animate({'top':projectedTop,'left':($(window).width()/2)+scrollPos['scrollLeft']-(popinWidth/2),'width':popinWidth,'height':popinHeight},settings.animationSpeed,function(){displayContent();});};var closeOverlay=function(){$('#overlay').fadeOut(settings.animationSpeed,function(){$(this).remove();});$('.prettyPopin').fadeOut(settings.animationSpeed,function(){$(this).remove();settings.callback()});};});function _centerPopin(){if(!_followScroll)return;if(!$('.prettyPopin'))return;var scrollPos=_getScroll();if($.browser.opera){windowHeight=window.innerHeight;windowWidth=window.innerWidth;}else{windowHeight=$(window).height();windowWidth=$(window).width();};projectedTop=($(window).height()/2)+scrollPos['scrollTop']-($('.prettyPopin').height()/2);if(projectedTop<0){projectedTop=10;_followScroll=false;}else{_followScroll=true;};$('.prettyPopin').css({'top':projectedTop,'left':($(window).width()/2)+scrollPos['scrollLeft']-($('.prettyPopin').width()/2)});};function _getScroll(){scrollTop=window.pageYOffset||document.documentElement.scrollTop||0;scrollLeft=window.pageXOffset||document.documentElement.scrollLeft||0;return{scrollTop:scrollTop,scrollLeft:scrollLeft};};};})(jQuery);